#!/usr/bin/env python# -*- coding:utf-8 -*-# @Time : 2026/1/29# @Author : cyq# @File : extract_methods# @Software: PyCharm# @Desc:from .base import BaseMethodsfrom ..locator.locator import get_locatorfrom ..wait.strategy import WaitStrategyfrom ..exceptions import VariableErrorfrom .context import StepContextclass GetAttrMethod(BaseMethods):    """    获取元素属性    """    handler_name = "play_get_attr"    async def execute(self, context: StepContext) -> None:        try:            key, attr_name = context.step.fill_value.split(";")        except Exception:            raise VariableError(                f"提取变量格式错误",                details=f"Expected format: key;attr_name, got: {context.step.fill_value}"            )        locator = await get_locator(context.page, context)        wait_strategy = WaitStrategy()        await wait_strategy.wait_for_element(locator, state="attached")        attr_value = await locator.get_attribute(attr_name)        if attr_value is None:            raise VariableError(                f"Attribute not found",                details=f"Attribute '{attr_name}' not found on element"            )        attr_value = attr_value.strip()        await context.variable_manager.add_var(key=key, value=attr_value)        await context.starter.send(f"提取变量 ✅ : {key} = {attr_value}")class GetTextMethod(BaseMethods):    """    获取文案    """    handler_name = "play_get_text"    async def execute(self, context: StepContext) -> None:        key = context.step.fill_value.strip()        locator = await get_locator(context.page, context)        wait_strategy = WaitStrategy()        await wait_strategy.wait_for_element(locator, state="visible")        text_value = await locator.inner_text()        await context.variable_manager.add_var(key=key, value=text_value.strip())        await context.starter.send(f"提取文本 ✅ : {key} = {text_value.strip()}")class GetValueMethod(BaseMethods):    handler_name = "play_get_value"    async def execute(self, context: StepContext) -> None:        key = context.step.fill_value.strip()        locator = await get_locator(context.page, context)        wait_strategy = WaitStrategy()        await wait_strategy.wait_for_element(locator, state="visible")        value = await locator.input_value()        await context.variable_manager.add_var(key=key, value=value.strip())        await context.starter.send(f"提取值 ✅ : {key} = {value.strip()}")class GetCountMethod(BaseMethods):    handler_name = "play_get_count"    async def execute(self, context: StepContext) -> None:        key = context.step.fill_value.strip()        locator = await get_locator(context.page, context)        wait_strategy = WaitStrategy()        await wait_strategy.wait_for_element(locator, state="attached")        count = await locator.count()        await context.variable_manager.add_var(key=key, value=str(count))        await context.starter.send(f"提取数量 ✅ : {key} = {count}")