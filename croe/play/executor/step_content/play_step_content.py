#!/usr/bin/env python# -*- coding:utf-8 -*-# @Time : 2026/1/30# @Author : cyq# @File : play_step_content# @Software: PyCharm# @Desc:import datetimefrom app.mapper.play import PlayStepV2Mapperfrom app.model.playUI.PlayResult import PlayStepContentResultfrom ._base import StepBaseStrategyfrom croe.play.context import StepContentContext, StepContextfrom utils import log, GenerateToolsclass PlayStepContentStrategy(StepBaseStrategy):    """    ui 单步骤执行    """    async def execute(self, step_content: StepContentContext) -> bool:        step = await PlayStepV2Mapper.get_by_id(step_content.play_step_content.target_id)        step_context = StepContext(            step=step,            page_manager=step_content.page_manager,            starter=step_content.starter,            variable_manager=step_content.variable_manager        )        start_time = datetime.datetime.now()        SUCCESS, message = await self.play_executor.execute(            step_context        )        log.info(f"[PlayStepContentStrategy] execute step: {step.name}, success: {SUCCESS}, message: {message}")        await self.write_result(            success=SUCCESS,            message=message,            start_time=start_time,            step_content=step_content        )        return SUCCESS    @staticmethod    async def write_result(            success: bool,            message: str,            start_time: datetime.datetime,            step_content: StepContentContext):        """        暂存结果        """        end_time = datetime.datetime.now()        content_result = PlayStepContentResult(            content_id=step_content.play_step_content.id,            content_name=step_content.play_step_content.content_name,            content_desc=step_content.play_step_content.content_desc,            content_type=step_content.play_step_content.content_type,            starter_id=step_content.starter.userId,            starter_name=step_content.starter.username,            start_time=start_time,            use_time=GenerateTools.timeDiff(start_time, end_time)        )        content_result.content_result = success        content_result.content_message = message        await step_content.play_step_result_writer.add_content_result(content_result)