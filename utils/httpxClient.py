#!/usr/bin/env python# -*- coding:utf-8 -*-# @Time : 2024/7/3# @Author : cyq# @File : httpxClient# @Software: PyCharm# @Desc:import httpxfrom httpx import Response, Timeout, TimeoutException, ReadTimeout, ConnectTimeoutfrom enums import InterfaceResponseErrorMsgEnumfrom utils import MyLoguruLOG = MyLoguru().get_logger()class HttpxClient:    def __init__(self, log=None,                 hooks: dict = None, **kwargs):        default_event_hooks = {'request': [self.log_request],                               'response': [self.log_response]}        self.log = log if log else LOG        self.client = httpx.AsyncClient(            headers={"Content-Type": "application/json",                     "user-agent": "case_Hub_http/v0.1"}        )        self.client.event_hooks = hooks or default_event_hooks    async def __call__(self,                       method: str,                       url: str,                       **kwargs):        """        :param method:        :param url:        :param kwargs:        :return:        """        self.log.debug(f"{method.upper()} {url}")        timeout = Timeout(            None,            connect=kwargs.pop("connect"),            read=kwargs.pop("read")        )        self.client.timeout = timeout        return await self.invoke(method=method.lower(),                                 url=url,                                 **kwargs)    async def invoke(self, method, url, **kwargs) -> Response:        try:            response = await getattr(self.client, method)(                url,                **kwargs            )            return response        except ReadTimeout as e:            raise ReadTimeout(InterfaceResponseErrorMsgEnum.ResponseTimeout)        except ConnectTimeout as e:            raise ReadTimeout(InterfaceResponseErrorMsgEnum.ConnectTimeout)        except Exception as e:            raise e    async def log_request(self, request) -> None:        self.log.info(f"Hook: request  {request.method.upper()} : {request.url}")    async def log_response(self, response: Response) -> None:        self.log.info(f"Hook: response status_code >> {response.status_code}")