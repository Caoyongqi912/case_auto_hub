#!/usr/bin/env python# -*- coding:utf-8 -*-# @Time : 2024/6/15# @Author : cyq# @File : redis_# @Software: PyCharm# @Desc:import jsonfrom typing import List, Mapping, Any, Dictfrom awaits import awaitablefrom redis import ConnectionPool, StrictRedisfrom config import Configfrom utils import logdef client():    pool = ConnectionPool(host=Config.REDIS_SERVER,                          port=Config.REDIS_PORT,                          # password=Config.REDIS_PASSWORD,                          db=Config.REDIS_DB,                          max_connections=100,                          decode_responses=True)    return StrictRedis(connection_pool=pool, decode_responses=True)class RedisManager:    _redis_client: StrictRedis = client()    @classmethod    def h_set(cls, name: str, value: Mapping[str, Any]):        cls._redis_client.hset(name=name, mapping=value)    @classmethod    def get_keys(cls, key: str):        val = cls._redis_client.hgetall(key)        return val    @classmethod    def remove_key(cls, key: str):        return cls._redis_client.delete(key)    @classmethod    def l_push(cls, name: str, values: List[str]):        cls._redis_client.lpush(name, *values)    @classmethod    def l_range(cls, name: str):        return cls._redis_client.lrange(name=name, start=0, end=-1)    @classmethod    @awaitable    def set_record(cls, name: str, value: Mapping[str, Any]):        """录制"""        name = f"record_{name}"        if cls._redis_client.exists(name):            value = cls._redis_client.delete(name)        return cls._redis_client.hset(name=name, mapping=value)    @classmethod    @awaitable    def query_record(cls, name: str):        data = cls._redis_client.lrange(name=name, start=0, end=-1)        datas = [json.loads(i) for i in data]        return datas    @classmethod    @awaitable    def stop_record(cls, name: str):        """停止录制"""        name = f"record_{name}"        return cls._redis_client.delete(name)    @classmethod    @awaitable    def clear_record(cls):        keys = cls._redis_client.keys("record_*")        for key in keys:            cls._redis_client.delete(key)if __name__ == '__main__':    # asyncio.run(RedisManager.get_key())    name1 = "127.0.0.1"    exclude1 = {"url": "10.1.1.110",                "method": "get",                "userId": "88a49ede"}    RedisManager.set_record(        name=name1,        value=exclude1    )