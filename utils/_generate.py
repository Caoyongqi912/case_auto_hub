#!/usr/bin/env python# -*- coding:utf-8 -*-# @Time : 2024/6/6# @Author : cyq# @File : _generate# @Software: PyCharm# @Desc:from typing import List, Any, Dict, Optional, Unionfrom uuid import uuid4from datetime import datetime, timedeltaimport timeclass KVItem:    KEY = "key"    VALUE = "value"class GenerateTools:    @classmethod    def uid(cls) -> str:        """        生成uuid        :return: uuid4        """        return str(uuid4())[:8]    @staticmethod    def list2dict(items: Optional[Union[List[Dict[str, Any]], Dict[str, Any]]] = None) -> Dict[str, Any]:        """        将包含键值对的字典列表转换为扁平字典。        支持两种输入格式：        1. 字典列表：每个字典需包含 KEY 和 VALUE 字段        2. 单个字典：直接包含 KEY 和 VALUE 字段        参数:            items: 包含 key 和 value 字段的字典列表或单个字典        返回:            转换后的字典，仅包含非空 key 和有效 value 的项        """        if items is None:            return {}        result = {}        # 统一处理：将单个字典转换为列表        items_list = items if isinstance(items, list) else [items]        for item in items_list:            # 跳过非字典类型或不完整的字典            if not isinstance(item, dict):                continue            key = item.get(KVItem.KEY)            value = item.get(KVItem.VALUE)            # 验证 key 的有效性            if not key or not isinstance(key, str) or key.strip() == "":                continue            # 处理 value            if value is None:                continue            # 如果是字符串，去除首尾空白            if isinstance(value, str):                value = value.strip()                if value == "":  # 空字符串视为无效值                    continue            result[key] = value        return result    @staticmethod    def getTime(detail: int):        """       获取当前时间       :param detail:            1:%Y-%m-%d %H:%M:%S            2:%Y-%m-%d            3:timeStamp            4:%H:%M:%S            5:%Y-%m-%d            6:%Y%m%d_%H%M%S       :return:time       """        if detail == 3:            return int(time.time()) * 1000        opt = {1: "%Y-%m-%d %H:%M:%S",               2: '%Y-%m-%d',               5: "%Y-%m-%d",               4: "%H:%M:%S",               6: "%Y%m%d%H%M%S",               }        return datetime.now().strftime(opt[detail])    @staticmethod    def timeDiff(sTime: datetime, eTime: datetime):        """        计算时间差        :param sTime:        :param eTime:        :return:        """        time_diff = eTime - sTime        hours, remainder = divmod(time_diff.seconds, 3600)        minutes, seconds = divmod(remainder, 60)        return f"{hours:02d}:{minutes:02d}:{seconds:02d}"    @staticmethod    def getYesterday(day=7):        """        获取过去{day}天        :return:        """        today = datetime.today()        yesterday = today - timedelta(days=day)        yesterday_str = yesterday.strftime("%Y-%m-%d")        return yesterday_str    @staticmethod    def start_of_week():        """        """        today = datetime.today()  # 获取今天的日期和时间        start_of_week = today - timedelta(days=today.weekday())  # 计算本周的开始日期（周一）        start_of_week_date = start_of_week.date()  # 获取日期部分        return start_of_week_date    @staticmethod    def getMonthFirst() -> str:        """        获取当月1号        :return:        """        current_date = datetime.now()        # 构造当月1号日期        first_day_of_month = current_date.replace(day=1)        return first_day_of_month.strftime("%Y-%m-%d")    @staticmethod    def getYear():        return datetime.now().year    @staticmethod    def get_date_days_ago(days=7):        today = datetime.today()        seven_days_ago = today - timedelta(days=days)        return seven_days_ago.strftime('%Y-%m-%d')    @staticmethod    def calculate_time_difference(t: str):        # 将字符串格式的时间转换为 datetime 对象        time_a = datetime.strptime(t, '%Y-%m-%d %H:%M:%S')        # 获取当前时间        time_b = datetime.now()        # 计算时间差        time_diff = time_b - time_a        # 获取小时、分钟、秒和微秒        seconds = time_diff.total_seconds()        hours = int(seconds // 3600)        minutes = int((seconds % 3600) // 60)        seconds = seconds % 60        # 格式化秒数到小数点后 2 位        formatted_time = f"{hours:02}:{minutes:02}:{seconds:05.2f}"        return formatted_time