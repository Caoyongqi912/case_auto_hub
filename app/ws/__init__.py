#!/usr/bin/env python# -*- coding:utf-8 -*-# @Time : 2024/8/15# @Author : cyq# @File : __init__.py# @Software: PyCharm# @Desc:from typing import Dictfrom utils import logfrom socketio import AsyncServer, ASGIAppclass IOServerManager(AsyncServer):    def __init__(self):        super().__init__(            cors_allowed_origins=[],            async_handlers=True,            async_mode='asgi'        )    async def log_emit(self, data: Dict, ns: str):        log.debug(f"ns={ns} {data}")        data['sid'] = ns        return await self.emit(            "structure_log",            data=data        )io = IOServerManager()class ASGI(ASGIApp):    def __init__(self):        super().__init__(            socketio_server=io,            on_startup=setup_socketio,            on_shutdown=teardown_socketio        )async def setup_socketio():    log.debug("setup_socketio")async def teardown_socketio():    log.debug("teardown_socketio")@io.eventasync def connect(sid, environ):    log.debug(f"socket connect {sid}")@io.eventasync def disconnect(sid):    log.debug(f"socket disconnect {sid}")