#!/usr/bin/env python# -*- coding:utf-8 -*-# @Time : 2025/11/7# @Author : cyq# @File : service# @Software: PyCharm# @Desc:# app/celery_service.pyimport asynciofrom .app import celery_app, update_all_celery_schedulesfrom utils import logclass CeleryScheduleService:    """Celery定时任务管理服务"""    @staticmethod    async def reload_schedules_async():        """异步重新加载所有定时任务"""        return await update_all_celery_schedules()    @staticmethod    def reload_schedules_sync():        """同步重新加载所有定时任务"""        return asyncio.run(update_all_celery_schedules())    @staticmethod    def get_current_schedules():        """获取当前所有定时任务"""        return celery_app.conf.beat_schedule    @staticmethod    def get_schedule_count():        """获取定时任务数量"""        schedules = celery_app.conf.beat_schedule        api_tasks = len([k for k in schedules.keys() if k.startswith('api-task-')])        ui_tasks = len([k for k in schedules.keys() if k.startswith('ui-task-')])        return {            'total': len(schedules),            'api_tasks': api_tasks,            'ui_tasks': ui_tasks        }    @staticmethod    def remove_schedule(task_key: str):        """删除单个定时任务"""        if task_key in celery_app.conf.beat_schedule:            del celery_app.conf.beat_schedule[task_key]            log.info(f"删除定时任务: {task_key}")            return True        return False