#!/usr/bin/env python# -*- coding:utf-8 -*-# @Time : 2025/4/7# @Author : cyq# @File : tasks# @Software: PyCharm# @Desc:from enums import StarterEnumfrom interface.taskRunner import TaskRunnerfrom croe.interface.starter import APIStarterfrom croe.play.playTaskRunner import PlayTaskRunnerfrom croe.play.starter import UIStarterfrom app.scheduler.celer7.app import celery_appimport asynciofrom celery.app.task import Taskfrom utils import log@celery_app.task(name="execute_api_task", bind=True)  # ğŸ‘ˆ è¿™ä¸ªbind=Trueè®©å‡½æ•°æ¥æ”¶selfå‚æ•°def execute_api_task(self: Task, task_id: int):    """    æ‰§è¡ŒAPIä»»åŠ¡    :param self Task    :param task_id:    :return:    """    async def _execute():        log.info(f"CELERY æ‰§è¡Œä»»åŠ¡: {task_id}")        return await TaskRunner(APIStarter(StarterEnum.Celery)).execute_task(task_id)    try:        self.update_state(state="PROGRESS", meta={"status": "ä»»åŠ¡å¼€å§‹"})        asyncio.run(_execute(), )        self.update_state(state="SUCCESS", meta={"status": "ä»»åŠ¡ç»“æŸ"})    except Exception as e:        log.error(f"APIä»»åŠ¡æ‰§è¡Œå¤±è´¥: {task_id}, é”™è¯¯: {e}")        self.update_state(            state='FAILURE',            meta={'error': str(e)}        )        raise@celery_app.task(name="execute_ui_task", bind=True)def execute_ui_task(self: Task, task_id: int):    """    æ‰§è¡ŒUIä»»åŠ¡    :param self Task    :param task_id:    :return:    """    async def _execute():        return await PlayTaskRunner(UIStarter(StarterEnum.Celery)).execute_task(task_id)    try:        self.update_state(state="PROGRESS", meta={"status": "ä»»åŠ¡å¼€å§‹"})        asyncio.run(_execute())        self.update_state(state="SUCCESS", meta={"status": "ä»»åŠ¡ç»“æŸ"})    except Exception as e:        log.error(f"UIä»»åŠ¡æ‰§è¡Œå¤±è´¥: {task_id}, é”™è¯¯: {e}")        self.update_state(            state='FAILURE',            meta={'error': str(e)}        )        raise