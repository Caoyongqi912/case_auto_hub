#!/usr/bin/env python# -*- coding:utf-8 -*-# @Time : 2025/4/3# @Author : cyq# @File : tasks# @Software: PyCharm# @Desc:from app.model.base.job import AutoJobfrom utils import logfrom common.redis_worker_pool import r_pool, register_interface_task_RoBotasync def aps_submit_interface_task(job: AutoJob):    """    调度任务执行    :param job: 任务    """    if not r_pool.is_running:        raise RuntimeError("任务池未启动")    for task_id in job.job_task_ids:        await r_pool.submit_to_redis(            func=register_interface_task_RoBot,            name=job.job_name,            kwargs={                "task_id": task_id,                "env_id": job.job_kwargs.get("env_id"),            }        )async def run_heartbeat():    """可序列化的心跳任务函数"""    from common import rc    Key = "scheduler:master_lock"    await rc.init_pool()    if await rc.r.get(Key):        await rc.r.expire(Key, 60)        log.debug("✅ Renewed lock")