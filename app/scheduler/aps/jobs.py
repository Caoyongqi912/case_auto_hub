#!/usr/bin/env python# -*- coding:utf-8 -*-# @Time : 2025/12/11# @Author : cyq# @File : aps_jobs# @Software: PyCharm# @Desc: APS 定时任务import asynciofrom app.model.base.job import AutoJobfrom utils import logfrom common.redis_worker_pool import r_pool, register_interface_task_RoBotasync def aps_submit_interface_task(job: AutoJob):    """    调度任务执行    :param job: AutoJob 任务    """    if not r_pool.is_running:        raise RuntimeError("任务池未启动")    ## 添加到多个任务    ##    for task_id in job.job_task_id_list:        await r_pool.submit_to_redis(            func=register_interface_task_RoBot,            job_id=task_id,            job_name=job.job_name,            job_kwargs={                "task_id": task_id,                "env_id": job.job_env_id,                "retry": job.job_max_retry_count,                "retry_interval": job.job_retry_interval,            }        )async def aps_heartbeat():    """    可序列化的心跳任务函数    """    from common import rc    Key = "scheduler:master_lock"    await rc.init_pool()    if await rc.r.get(Key):        await rc.r.expire(Key, 60)        log.info("[Scheduler] : ✅ Renewed lock")async def print_jobs():    from .scheduler import hubScheduler     # await asyncio.to_thread(     #    hubScheduler._scheduler.get_jobs,    #    # )    jobs = await hubScheduler.get_jobs()    for job in jobs:        next_run_time = job.next_run_time        log.info(f"[Scheduler]: JOB {job} next_run_time {next_run_time}")#