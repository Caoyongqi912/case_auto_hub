#!/usr/bin/env python# -*- coding:utf-8 -*-# @Time : 2024/6/20# @Author : cyq# @File : __init__.py# @Software: PyCharm# @Desc:from sqlalchemy import selectfrom app.mapper import Mapperfrom app.mapper.project.dbConfigMapper import DbConfigMapperfrom app.mapper.project.env import EnvMapperfrom app.mapper.user import UserMapperfrom app.model import async_sessionfrom app.model.base import Project, User, GlobalVariableclass ProjectMapper(Mapper[Project]):    __model__ = Project    @classmethod    async def insert_project(cls, title: str, desc: str, chargeId: int, creatorUser: User):        """        插入项目        :param title:        :param desc:        :param chargeId:        :param creatorUser:        :return:        """        try:            async with async_session() as session:                charger = await UserMapper.get_by_id(ident=chargeId, session=session)                session.add(Project(                    title=title,                    description=desc,                    creator=creatorUser.id,                    creatorName=creatorUser.username,                    chargeId=chargeId,                    chargeName=charger.username,                ))                await session.commit()        except Exception as e:            raise e    @classmethod    async def query_info_count(cls, project_id: int, ):        """        """        try:            async with async_session() as session:                db_count = await DbConfigMapper.query_by(project_id=project_id)                env_count = await EnvMapper.query_by(project_id=project_id)                variable_count = await GlobalVariableMapper.query_by(project_id=project_id)                return {                    "db_count": len(db_count) if db_count else 0,                    "env_count": len(env_count) if env_count else 0,                    "variable_count": len(variable_count) if variable_count else 0                }        except Exception as e:            raise eclass GlobalVariableMapper(Mapper[GlobalVariable]):    __model__ = GlobalVariable    @classmethod    async def fetch_by_key(cls, key: str) -> GlobalVariable | None:        try:            async with async_session() as session:                data = await session.scalar(select(cls.__model__).where(                    cls.__model__.key == key                ))                return data        except Exception as e:            raise e