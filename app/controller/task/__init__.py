#!/usr/bin/env python# -*- coding:utf-8 -*-# @Time : 2024/11/7# @Author : cyq# @File : __init__.py# @Software: PyCharm# @Desc:import asynciofrom fastapi import APIRouterfrom app.response import Responsefrom app.ws import iofrom utils import logfrom pydantic import BaseModelrouter = APIRouter(prefix="/task", tags=["任务"])class Task(BaseModel):    task_id: str@router.post("/job1", description="任务1")async def test1(data: Task):    asyncio.create_task(task_test1(**data.dict()))    return Response.success()async def task_test1(task_id: str):    log.info("开始执行任务1")    for i in range(1, 10):        await asyncio.sleep(1)        await io.log_emit(data={"msg": f"任务1执行中 num = {i}", "code": 0},                          ns=task_id)    log.debug("任务1执行完毕")    await io.log_emit(data={"msg": f"任务1执行完成", "code": 1},                      ns=task_id)