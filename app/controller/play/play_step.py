#!/usr/bin/env python# -*- coding:utf-8 -*-# @Time : 2025/7/3# @Author : cyq# @File : play_step# @Software: PyCharm# @Desc:from fastapi import APIRouter, Dependsfrom app.controller import Authenticationfrom app.mapper.play.playStepMapper import PlayStepV2Mapperfrom app.model.base import Userfrom app.response import Responsefrom app.schema.play import InsertPlayStepSchema, CopyPlayStepSchemafrom app.schema.play.playStepSchema import EditPlayStepSchema, RemovePlayStepByIdSchema, PageCommonPlayStepSchemarouter = APIRouter(prefix="/play/step", tags=['公共步骤管理'])@router.post("/insert", description="插入步骤")async def insert_step(stepInfo: InsertPlayStepSchema, user: User = Depends(Authentication())):    """    新增步骤    :param stepInfo:    :param user:    :return:    """    step = await PlayStepV2Mapper.save(        creator_user=user,        **stepInfo.model_dump(            exclude_none=True,            exclude_unset=True        )    )    return Response.success(step)@router.get("/detail", description="步骤详情")async def get_step_detail(step_id: int, _: User = Depends(Authentication())):    """    获取步骤详情    :param step_id:    :param _:    :return:    """    step = await PlayStepV2Mapper.get_by_id(ident=step_id)    return Response.success(step)@router.post("/edit", description="修改步骤")async def edit_step(stepInfo: EditPlayStepSchema, user: User = Depends(Authentication())):    """    修改步骤    :param stepInfo:    :param user:    :return:    """    step = await PlayStepV2Mapper.update_by_id(        updateUser=user,        **stepInfo.model_dump(            exclude_none=True,            exclude_unset=True        ))    return Response.success(step)@router.post("/remove", description="删除步骤")async def remove_step(stepInfo: RemovePlayStepByIdSchema, _: User = Depends(Authentication())):    """    删除步骤    :param stepInfo:    :param _    :return:    """    await PlayStepV2Mapper.delete_by_id(ident=stepInfo.step_id)    return Response.success()@router.post("/page", description="分页")async def page_step(pageInfo: PageCommonPlayStepSchema, _: User = Depends(Authentication())):    data = await PlayStepV2Mapper.page_query(**pageInfo.model_dump(        exclude_unset=True,        exclude_none=True    ))    return Response.success(data)@router.post("/copy", description="step 复制")async def copy_step(step: CopyPlayStepSchema, user: User = Depends(Authentication())):    data = await PlayStepV2Mapper.copy_step(step_id=step.step_id,                                            user=user,                                            copy_step_name=False,                                            is_common=step.is_common)    return Response.success(data)