#!/usr/bin/env python# -*- coding:utf-8 -*-# @Time : 2024/8/28# @Author : cyq# @File : step_sql# @Software: PyCharm# @Desc:import loggingfrom play.extract import ExtractManagerfrom play.logWriter import LogWriterimport refrom utils import logfrom utils.oracleManager import OracleManagerclass SqlSender:    """    ui 步骤 执行读写    """    def __init__(self, city: str, logger: LogWriter, em: ExtractManager):        """        :param city:  城市        :param logger: 日志        :param em: 变量        """        self.city = city        self.logger = logger        self.em = em        self.sql = None    async def send_sql(self, sql_str: str):        self.sql = re.sub(r'\s+', ' ', sql_str).strip(";")        await self.logger.write_log(f'执行 >> {self.sql}')        om = OracleManager(self.city)        if self.sql.startswith(("select", "SELECT")):            keys = self.getVarList()            log.info(keys)            values = om.fetch_sql(self.sql)            log.info(values)            _ = dict(zip(keys, values))            await self.logger.write_log(f"获取变量 {_}")            await self.em.add_vars(_)        else:            return om.execute_sql(self.sql)    def getVarList(self):        return re.findall(r'select(.*?)from', self.sql, re.IGNORECASE)[0].strip().split(",")